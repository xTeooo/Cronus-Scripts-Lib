
/*
 ___       _______   ________  _________  ___  ___  ________  ___               ________  ________  ________   ________  ________     
|\  \     |\  ___ \ |\   __  \|\___   ___\\  \|\  \|\   __  \|\  \             |\   __  \|\   __  \|\   ___  \|\   ___ \|\   __  \    
\ \  \    \ \   __/|\ \  \|\  \|___ \  \_\ \  \\\  \ \  \|\  \ \  \            \ \  \|\  \ \  \|\  \ \  \\ \  \ \  \_|\ \ \  \|\  \   
 \ \  \    \ \  \_|/_\ \   __  \   \ \  \ \ \   __  \ \   __  \ \  \            \ \   ____\ \   __  \ \  \\ \  \ \  \ \\ \ \   __  \  
  \ \  \____\ \  \_|\ \ \  \ \  \   \ \  \ \ \  \ \  \ \  \ \  \ \  \____        \ \  \___|\ \  \ \  \ \  \\ \  \ \  \_\\ \ \  \ \  \ 
   \ \_______\ \_______\ \__\ \__\   \ \__\ \ \__\ \__\ \__\ \__\ \_______\       \ \__\    \ \__\ \__\ \__\\ \__\ \_______\ \__\ \__\
    \|_______|\|_______|\|__|\|__|    \|__|  \|__|\|__|\|__|\|__|\|_______|        \|__|     \|__|\|__|\|__| \|__|\|_______|\|__|\|__|

                                    ....................    .~YPGP57:                               
                                ..........      .  .....:..!5BBBBBBBG7                              
                             ......             ...     .:!GBBBGYJYGB#7                             
                           .:...             .            .~PGY7!!!5B&Y                             
                   ^!!~:. ... ...           .  !5P5Y?~.    .~?7!!7JG#G:                             
                 ^5GBBBGPJ: ...           ... :J!^::^~~.    .^JP5PPY7.                              
                !BBBBGBB#Y .   .::.      ......    :^:.   ....^7~^.                 .^!77!77~.      
                PBB577?JP~   :YGPY!..           :?PGGBP?:     .^^:               .!YPB##B####B5.    
                Y#B57!!!7^  .PY^        .   .  ~GBBBBBGGGY!:.   :~^            :?GBBBBBBBBBGPJ~     
                .JG##GP55:  ~7  :7???!^.     . 5#BBBG!!7?Y#BPJ.  :~:        ..~P#BBBBBBBBG?^        
                  .~?Y55J:  .  ~G###BBB5~::... ^5GBBP~GGG~GBB&J  :~^    :~7J5GGBBBBBBBBBBBBG7       
                        .. .  !B5?JGBGGBGGBGGY. .^!5BPJJ?PBBB#! .^^^:~J5GBBBBBBBBBB#####BPJ~.       
                        : ..^JGJ^5PGBBBBBBB##7     .7G#B###BP!  :^~YPBBBBBBBBBBBB#BYJJ7~:           
                        : .?GBB5PBBBBBBBBBBP7 .^:.. ::?55Y7^.  :^!PBBBBBBBBBBBB##P^                 
                        :. YBGPGBBBBBBB###J^^7YBG.  :        .:^?GBBBBBBBBBB###G!.                  
                         ^75GGBBBBBBB#GY75GB###P~ .^: .   ..:~?PBBBBBBBBBB###G7.                    
                      .!YGBBBBBBBBB#G~:. .^~~!!::^~:  ...:~75GBBBBBBBB#####P7.                      
                    .7PBBBBBBBBBBB#P:   .::^!JPBG5^ ~!7?YPB#&###########&P^                         
                   ~PBBBBBBBBBBBB#B?!!~~!?^:~7?!^.^Y###B#BB#############Y.                          
                  ~GBBBBBBBBBBBB#BB###BB##BP5J?JY5GGGGGGBBBB##########G~                            
                  PBBBBBBBBBB###B###BBBBBBG5J?!~^::..:::^~!?YPB#&&###J.                             
                  J##BBB##BGGB#&###BBBB5?~:.                 .:~JYP5^                               
                   !J5GBBG5PPY5PYJBBP?^.    ....                 :^^.                               
                       ......    :J~.  ... .  ............       .^^^:                              
                                 :       . ...::::...........     .^^^^                             
                                .. ..   ...:...             .      ^^^~^                            
                                :.      . .                        .^^^^:                           
                                :.                                 .^^^^^                           
                                :.                                 :~^^^^.                          
                                :.  .       ....                  .^^^^^~^                          
                                :^  .       ......            .. .:^^^^^7B~                         
                               ^55^.        .......            ..^^^^^^~G##~                        
                              7GBB5~:.          .            ..:^^^^^^~5B##B:                       
                            .?BBBBBP7^:..                 ..:^^^^^^^^7PBBBB&5                       
                            ?GBBBBBBB5!^^^::..........::^^^^^^^^^^^!YBBBBBB##~                      
                           !PBBBBBBBBBB5?~^^^^^^^^^^^^^^^^^^^^^^~7YGBBBBBBBB&Y                      
                          .YGBBBBBBBBBBBBBPY?!~~~^^^^^^^^~~~!7J5GBBBBBBBBBBB#G.                     
                          .YBBBBBBBBBBBBB#####GY~:::::::::?PB##BBBBBBBBBBBBBB#5.                    
                           !PBBBBBBBBBBB####B?:.           .^?G#GGGBBBBBBBBBBB#Y                    
                          . ~5GBBBBBBBBBB###~                 .?PP5PBBBBBBBBBBB#7                   
                             ~P#BBBBBBBBB###~                   ^YGGBBBBBBBBBBBBB:                  
                              :JGBBBBBBBBBBBP.                    !P#BBBBBBBBBBBBP:                 
                                ~5BBBBBBBBB##Y                      ~5BBBBBBBBBBB#G?^               
                            .~JPPGBBBBBBBBB##&!                       ^YBBBBBBBBBBBBBY^             
                           ^5B#BBBBBBBBBB##&##!                         ^GBBBBBBBBBBB##^            
                           !GBBBBBBBBBGGP5YJ7^                           ~PBBB###B#BBBY.            
77!!777777777777777777??7777JYJJYYYYJJ??7777777777777777777777777777777777?J5PP55PPYYJ77777777?77777
P?!!!5J?JJJJJJ?YY?JJJ?J?Y?J???J5555555555555PPPPPPPPPPPPPPPPPPPPPPPPPPPPP55555555JYYJJJJJJYY5YJYYY5P
5Y??J5YYYYYYYYYYYYYYYYYYYJYJJYY5555555555555555555555555555555555555555555555555555555Y5555555Y5YY55




KILL SWITCH MOD IS LT/L2 + SHARE/


*/

   
define dash_board             = 0;
define AntiRecoilMenu         = 1;
define Polar_Aim_Menu         = 2;
define Tracker_Menu           = 3;
define ButtonLayout           = 4;
define StickLayout            = 5;
define Slide_Cancel_Mod_Menu  = 6;
define Rapid_FIRE_menu        = 7;
define ping_Menu              = 8; 
define Bunny_Menu             = 9;
define Rumble_Menu            =10;
define cycle_limit  = 10;
define cycle_return = 1;

int construct = 2,screen_saver = 1, clear,strobing_a,strobing_b,Menu;
int EditMenu;
int refresh_edit;
int stick_input
int edit_idx;
define EDIT_VAL_printf_Y = 18; // aim_y coordinate for print Edit Value

const string MenuOption[] = { " OPEN MENU ", "CLOSE MENU", "PANDA AIM V4"};
const string submenu_idx[] = {
	"DASH BOARD",   // 0. 
	"ANTI RECOIL",  // 1.
	"POLAR AIM",    // 2.
	"TRACKER",      // 3.
	"BUTTON LAYOUT",// 4.
	"STICK LAYOUT", // 5. 
	"SLIDE CANCEL", // 6.       
	"RAPID FIRE",   // 7.
	"AUTO PING",    // 8.
	"BUNNY HOP",    // 9.
	"RUMBLE"        //10.
};



const uint8 ModNames_char_count [] ={

	0, // "DASH BOARD"    //0
	11,// "LEGACY "       //1  
	9,//  "POLAR AIM"     //2
	7, // "TRACKER"       //3
	13,// "BUTTON LAYOUT" //4 
	12,// "STICK LAYOUT"  //5
	12,// "SLIDE CANCEL"  //6
	10,// "RAPID FIRE"    //7
	9, //  AUTO PING      //8
	9, // BUNNY HOP       //9
	6  // RUMBLE          //10
}
const uint8 Edit_ind []={
	0,//0
	1,//1
	1,//2
	1,//3
	0,//4
	0,//5
	1,//6
	1,//7
	0,//8
	0,//9
	0 //10
}
const string option_idx[] = {
	"OFF", "ON",
	"WARZONE"
};
/*===========================
       BUTTON LAYOUT
===========================*/
const string BL_str [] = {
	"DEFAULT",          // 0
	"TACTICAL",         // 1
	"LEFTY",            // 2
	"N0M4D/CHARLIE",    // 3
	"NOM4D/CH TACTICAL",// 4
	"NOM4D/CHARL L3F7Y",// 5
	"BUMPER JUMPER",    // 6
	"BUMP/JUM TACTICAL",// 7
	"ONE-HAND GUNSLING",// 8
	"STICK AND MOVE",   // 9
	"BRAWLER",          // 10
	"BEAST",            // 11
	"DEFAULT SWAPPED",  // 12
	"BUMP/J SWAPPED",   // 13 
	"BUMP/J TACT SWAPP",// 14
	"STICK & MOVE SWAP",// 15
	"TACTICAL SWAPPED" ,// 16
	"BUMPER PING",      // 17
	"BUMP/ PING TACT"   // 18    
	
};

/*===========================
        STICK LAYOUT
===========================*/
const string SL_str [] = {
	"DEFAULT",          // 0
	"SOUTHPAW",         // 1
	"LEGACY",           // 2
	"LEGACY SOUTHPAW",  // 3
	
	"SOUTHPAW",         // 4
	"NO CLICK SWAP",    // 5
	
	"LEGACY SOUTHPAW",  // 6
	"NO CLIC SWAP"      // 7
}; 


/*==========================
   EDIT VALUES STRINGS
===========================*/
const string EditValuesNames [] ={
	"RADIUS",          //0
	"STEPS" ,          //1 
	"WARZONE DELAY",   //2
	"TRACKER STRENGTH",//3
	"TRACKER SPEED",   //4
	"VERTICAL",        //5
	"HORIZONTAL",      //6
	"RATE OF FIRE",    //7
	"STRENGTH",	       //8
    "SPEED"	           //9
}

/*==========================
   CHARACTER STRINGS
===========================*/
const uint8 CharCount [] ={
	6, //RADIUS         
	5, //STEPS            
	14,//WARZONE_SLIDE   
	16,//TRACKER STRENGTH
	13,//TRACKER SPEED   
	8, //VERTICAL RECOIL        
	10,//HORIZONTAL RECOIL     
	12,//RATE OF FIRE     
	8, //STRENGTH         
	5  //SPEED            	
}
/*===========================
        MENU MIN/MAX
===========================*/
const uint8 Min_Max [][] = {
	{0, 0 },// DASH BOARD   
	{5, 6 },// LEGACY RECOIL   
	{0, 1 },// POLAR AIM
	{3, 4 },// POLAR
	{0, 0 },// BUTTON LAYOUT
	{0, 0 },// STICK LAYOUT
	{2, 2 },// SLIDE CANCEL   
	{7, 7 } // RAPID FIRE
	
}  

const int16 TrackerCords[] 		= {
	0, 8, 17,23, 34, 41, 52, 59,63,69, 75 ,81,87, 90, 104, 121, 139, 156,173, 190, 207, 224, 241, 258, 275, 292, 309, 325,342, 358, 374, 390, 406, 422, 438, 453, 469, 484,500, 515, 529, 544, 559, 573, 587, 601, 615, 629,642, 656, 669, 682, 694, 707, 719, 731, 743, 754,766, 777, 788, 798, 809, 819, 829, 838, 848, 857,866, 874, 882, 891, 898, 906, 913, 920, 927, 933, 939, 945, 951, 956, 961, 965, 970, 974, 978, 981,984, 987, 990, 992, 994, 996, 997, 998, 999, 999,1000
}

init{
	LOAD_PVARS()
	drift_calib = 100;	
	mvt_direction = 1;
	
	update_timer = REFRESH_RATE;
	
	if(ToggleInverted == 1)
	inverted = -1;
	else
	inverted = 1;
	TrackerAngle = 270 * inverted;

	led(6);

}	

/*==============================================================
						MAIN BLOCK
==============================================================*/
main
{
    set_val(TRACE_3,Toggle_AntiRecoil);
    set_val(TRACE_4, RecoilV)
    set_val(TRACE_5, RecoilH);
	


	//--- TURN SCRIPT ON/OFF  KillSwitch
	if((get_ival(PS4_L2) > 50 && event_release(PS4_SHARE))){
		
		KillSwitch = TRUE;
		display_QT(1);
		led(Red)
		set_val(PS4_SHARE, 0);
		combo_run(RUMBLE_ON);
	}

	if( construct  ) { 
		cls_oled( 1 );
		
		if( Menu == dash_board ) { 
			draw_picture(0, 0);
			draw_picture(0, 0);
			clear = 0; screen_saver = 1;
		}
	
		else if( Menu ) { 
			rect_oled( 1, 1, 126, 17, 1, 0 );
			print( center_x( 12, ofsw ), 48, 0, 0, MenuOption[ 2 ] );
			
			
			//--- RAPID FIRE  1.
			if( Menu == Rapid_FIRE_menu ) { 
				printf_mod_name();
				if( ToggleRapidFIRE == 0 ) { print( center_x( 3, ofmw ), 20, 1, 0, option_idx[ 0 ] ); led( Red);   } 
				if( ToggleRapidFIRE == 1 ) { print( center_x( 2, ofmw ), 20, 1, 0, option_idx[ 1 ] ); led( SkyBlue ); combo_run(RUMBLE_ON)}
				
			}
			//--- SLIDE CANCEL  2.
			if( Menu == Slide_Cancel_Mod_Menu ) { 
				printf_mod_name();
				if( ToggleSlideCancel == 0 ) { print( center_x(3, ofmw ), 20, 1, 0, option_idx[ 0 ] );led( Red )}
				if( ToggleSlideCancel == 1 ) { print( center_x(7, ofmw ), 20, 1, 0, option_idx[ 2 ] ); led( SkyBlue ); MwSlide = 1; }

			}
			//--- POLAR AIM   3.
			if( Menu ==Polar_Aim_Menu ) { 
				printf_mod_name();
				if( TogglePolarAim == 0 ) { print( center_x( 3, ofmw ), 20, 1, 0, option_idx[ 0 ] ); led( Red  ); TogglePolarAim = 0}
				if( TogglePolarAim == 1 ) { print( center_x( 2, ofmw ), 20, 1, 0, option_idx[ 1 ] ); led(SkyBlue ); TogglePolarAim = 1combo_run (RUMBLE_ON)}	
			}
			
			//--- TRACKER MENU 4.
			if( Menu == Tracker_Menu){
				printf_mod_name();
				if(  ToggleTracker == 0 ) { print( center_x( 3, ofmw ), 20, 1, 0, option_idx[ 0 ]  ); led(Red); }
				if(  ToggleTracker == 1 ) { print( center_x( 2, ofmw ), 20, 1, 0, option_idx[ 1 ]  ); led( SkyBlue ); combo_run(RUMBLE_ON)}
			}
			//LEGACY MENU 5.
			if( Menu == AntiRecoilMenu ){
				printf_mod_name();
				if(  Toggle_AntiRecoil == 0 ) { print( center_x( 3, ofmw ), 20, 1, 0, option_idx[ 0 ]  ); led(Red); }
				if(  Toggle_AntiRecoil == 1 ) { print( center_x( 2, ofmw ), 20, 1, 0, option_idx[ 1 ]  ); led( SkyBlue ); combo_run(RUMBLE_ON)}
			}
			//AUTO PING MENU 6.
			if( Menu == ping_Menu  ){
				printf_mod_name();
				if(  TogglePing == 0 ) { print( center_x( 3, ofmw ), 20, 1, 0, option_idx[ 0 ]  ); led(Red); }
				if(  TogglePing == 1 ) { print( center_x( 2, ofmw ), 20, 1, 0, option_idx[ 1 ]  ); led( SkyBlue ); combo_run(RUMBLE_ON)}
			}
			//BUNNY HOP MENU 7.
			if( Menu ==  Bunny_Menu){
				printf_mod_name();
				if(  ToggleBunnyHop == 0 ) { print( center_x( 3, ofmw ), 20, 1, 0, option_idx[ 0 ]  ); led(Red); }
				if(  ToggleBunnyHop== 1 ) { print( center_x( 2, ofmw ), 20, 1, 0, option_idx[ 1 ]  ); led( SkyBlue ); combo_run(RUMBLE_ON)}
			}
			
			//-- BUTTON LAYOUT 8.
			if( Menu == ButtonLayout ) { 
				printf_mod_name();
				if( BUTTON_LAYOUT >= 0 && BUTTON_LAYOUT < 19) OptionMenu_BL ( Opt_BL [ BUTTON_LAYOUT ], BUTTON_LAYOUT ) led( SkyBlue );combo_run(RUMBLE_ON);
			}
			//--- STICK LAYOUT 9.
			if( Menu == StickLayout ) { 
				printf_mod_name();
				if(STICK_LAYLOUT == 0) {print( center_x( 7, ofsw ), 20, ofs, 0, SL_str[ 0 ] ); led( SkyBlue );  STICK_LAYLOUT = 0; }// DEFAULT
				if(STICK_LAYLOUT == 1) {print( center_x( 8, ofsw ), 20, ofs, 0, SL_str[ 1 ] ); led( SkyBlue );  STICK_LAYLOUT = 1; }// SOUTHPAW
				if(STICK_LAYLOUT == 2) {print( center_x( 6, ofsw ), 20, ofs, 0, SL_str[ 2 ] ); led( SkyBlue );  STICK_LAYLOUT = 2; }// LEGACY
				if(STICK_LAYLOUT == 3) {print( center_x(15, ofsw ), 20, ofs, 0, SL_str[ 3 ] ); led( SkyBlue );  STICK_LAYLOUT = 3; }// LEGACY SOUTHPAW
				
				if(STICK_LAYLOUT == 4) {print( center_x( 8, ofsw ), 20, ofs, 0, SL_str[ 4 ] ); led( SkyBlue );  STICK_LAYLOUT = 4; }// SOUTHPAW (SOUTHPAW NO CLICK SWAP)
				if(STICK_LAYLOUT == 5) {print( center_x(13, ofsw ), 30, ofs, 0, SL_str[ 5 ] ); led( SkyBlue );  STICK_LAYLOUT = 4; }// NO CLICK SWAP (SOUTHPAW NO CLICK SWAP)
				
				if(STICK_LAYLOUT == 6) {print( center_x(15, ofsw ), 20, ofs, 0, SL_str[ 6 ] ); led( SkyBlue );  STICK_LAYLOUT = 5; }// LEGACY SOUTHPAW (LEGACY SOUTHPAW NO CLICK SWAP)
				if(STICK_LAYLOUT == 7) {print( center_x(12, ofsw ), 30, ofs, 0, SL_str[ 7 ] ); led( SkyBlue  );  STICK_LAYLOUT = 5; }// NO CLIC SWAP (LEGACY SOUTHPAW NO CLICK SWAP)
			}
			//--- RUMBLE MENU 10.
			if( Menu == Rumble_Menu ) { 
				printf_mod_name();
				if(  ToggleVibration == 0 ) { print( center_x( 3, ofmw ), 20, 1, 0, option_idx[ 0 ]  ); led(Red); }
				if(  ToggleVibration== 1 ) { print( center_x( 2, ofmw ), 20, 1, 0, option_idx[ 1 ]  ); led( SkyBlue ); combo_run(RUMBLE_ON)}
			}
				
			
			
			screen_saver = 0;
		}
		
		construct = 0;
	}
	
	//----GLOBAL MENU
	//===================================\\
	//   ALL CODE FOR MODS ARE HERE MAIN //
	//===================================\\	
	vm_tctrl(-6);


		if( Menu == dash_board && !EditMenu && !KillSwitch) { 
			//--- OPEN MENU 
			if( get_val( XB1_LT )){
				if(event_press( XB1_MENU ) ) { 
					Menu = AntiRecoilMenu; 
					construct = 1; 
					EditMenu  = FALSE; 
					set_val(XB1_MENU,0);
					KS_Rapid_FIRE = FALSE
				}
			}
	if(drift_calib)
	{
		rx_drift = max(rx_drift, abs(get_ival(PS4_RX))+ 2);
		ry_drift = max(ry_drift, abs(get_ival(PS4_RY))+ 2);
		
		lx_drift = max(lx_drift, abs(get_ival(PS4_LX))+ 2);
		ly_drift = max(ly_drift, abs(get_ival(PS4_LY))+ 2);
			
		rx_drift = min(rx_drift, MAX_DRIFT);
		ry_drift = min(ry_drift, MAX_DRIFT);
		
		lx_drift = min(lx_drift, MAX_DRIFT);
		ly_drift = min(ly_drift, MAX_DRIFT);
		
		drift_calib--;
		
		rx_drift = max(rx_drift, ry_drift);
		lx_drift = max(lx_drift, ly_drift);
	}
	else
	{					
		
			C_RX = get_ival(PS4_RX);
			C_RY = get_ival(PS4_RY);
			
			C_LX = get_ival(PS4_LX);
			C_LY = get_ival(PS4_LY);
				
			if(isqrt(pow(C_RX, 2) + pow(C_RY, 2)) <= rx_drift)
			{
				C_RX = 0;
				C_RY = 0;
			}

			if(isqrt(pow(C_LX, 2) + pow(C_LY, 2)) <= lx_drift)
			{
				C_LX = 0;
				C_LY = 0;
			}
			
			if(KillSwitch == 0)
			{
				if(get_val(ADS) > 50 || get_val(FIRE) > 50 )
				{									
					if(update_timer >= REFRESH_RATE)
					{					
						block(PS4_RX, REFRESH_RATE);
						block(PS4_RY, REFRESH_RATE);
						
						_ret = get_mvt_direction(C_RX, L_RX);
											
						if(_ret != 0)
							mvt_direction = _ret;
						
						update_timer = 0;	
						
						L_RX = C_RX;
						walk = C_RY;
					}	

					set_val(PS4_RX, clamp(C_RX, -100, 100));
					set_val(PS4_RY, clamp(C_RY, -100, 100));
					
					update_timer += get_rtime();
				}
				else
				{
					update_timer = 0;
					update_timer = REFRESH_RATE;
				
					TrackerAngle = 90 * inverted;
					
					set_val(PS4_RX, C_RX);
					set_val(PS4_RY, C_RY);
				}
				
			
					set_val(PS4_LX, C_LX);
					set_val(PS4_LY, C_LY);
				
				
				   
	 }
		}
		
		

	// RUMBLE/VIBRATION
			if(ToggleVibration == FALSE)
			{
				block_rumble();
			}

    // RE ENABLE KILLSWITCH
		if(event_press(PS4_SQUARE) &&( !Menu ))
	       		{
	       				KillSwitch = FALSE;
	       			
	       		}
	       			set_val(TRACE_3,KillSwitch);
	
	}
	
			
			if(KillSwitch == 0)		    
				   
	//--- SLIDE CANCEL
			if(ToggleSlideCancel)
			{
				if( abs(get_val(PS4_LY)) > 80 || abs(get_val(PS4_LX)) > 80 )
				{
					if(event_release(CROUCH))
					{
						if (MwSlide) combo_run(WARZONE_SLIDE);
						
					
					} 
				}
			}
		
		 if(KillSwitch == 1)
		if(double_click(RELOAD) && get_ptime(RELOAD)<= 496)
			
	       		{
	       				KillSwitch = FALSE;
	       				led(SkyBlue)
	       				display_QT(1);
	       				clear = 0;
		              
	       		}
	       			
	  
	stick_input = (isqrt(pow(get_ival(PS4_RX),2) + pow(get_ival(PS4_RY),2)));
      if(KillSwitch == 0)
		if(TogglePolarAim)
		{
			if (POLARBOOSTER && get_ival(FIRE)) 
			{
				Radius = PolarRadius + PR_BOOST;
			}
			else 
			{
				Radius = PolarRadius;
			}
			if (get_ival(ADS) || (get_ival(FIRE)))
			{
				if (stick_input <= Radius)
				{ 
					rnd = random(mn, mx);
					RS_gr = (RS_gr + PolarSteps) % 360;
					set_polar(RS, RS_gr, (Radius * rnd));
				
				}
				
			} 
		}
		
		C_RX = get_ival(aim_x);
		C_RY = get_ival(aim_y);
		
		if(get_val(ADS) > 50 || get_val(FIRE) > 50)
		{									
			if(update_timer >= REFRESH_RATE)
			{					
				block(aim_x, REFRESH_RATE);
				block(aim_y, REFRESH_RATE);
				
				_ret = get_mvt_direction(C_RX, L_RX);
				
				if(_ret != 0)
				mvt_direction = _ret;
				
				update_timer = 0;	
				
				L_RX = C_RX;
				C_RY = C_RY;
			}	
			
			
			if(KillSwitch == 0)
			{		
		if(ToggleTracker)
				{
					if(mvt_direction == 1)
					{
						C_RX += get_polar_coordinate(TrackerStrength, sin(TrackerAngle));
						C_RY += get_polar_coordinate(TrackerStrength, cos(TrackerAngle));
					}
					else
					{
						C_RX += get_polar_coordinate(TrackerStrength, cos(TrackerAngle));
						C_RY += get_polar_coordinate(TrackerStrength, sin(TrackerAngle));
					}
					
					TrackerAngle = ((TrackerAngle + TrackerSpeed)%360);
				}
	 
			
			{
			if(KillSwitch == 0)
					
			if(Toggle_AntiRecoil)
			{ 
			if( get_val(ADS) && get_val(FIRE )) {  
				
				combo_run(AntiRecoil);                 
			}else{
			if(  get_val(FIRE )) {  
				
				combo_run(AntiRecoil);                 
			}               
			
			if( abs(get_val(aim_y)) > RecoilV + 2 || abs(get_val(aim_x)) > RecoilV + 2) {
				
				combo_stop (AntiRecoil);               
			}                                
		} 
	}
}		
					set_val(PS4_RX, clamp(C_RX, -100, 100));
					set_val(PS4_RY, clamp(C_RY, -100, 100));
					
					update_timer += get_rtime();
				}
		
			set_val(aim_x, clamp(C_RX, -100, 100));
			set_val(aim_y, clamp(C_RY, -100, 100));
			
			update_timer += get_rtime();
		}
		else
		{
			update_timer = 0;
			update_timer = REFRESH_RATE;
			
			TrackerAngle = 0 * inverted;
			
			set_val(aim_x, C_RX);
			set_val(aim_y, C_RY);
		}
		{
if(get_val(SWITCH)   && get_ptime(SWITCH) <= 496)
	combo_run (YY)
	else combo_stop(YY)
	
	}
	
	if(ToggleBunnyHop){
		
		if(get_ival(JUMP) && get_ptime(JUMP) > 200) 
		combo_run(Bunnyhop); 	
		
		led_on  = 150;
		led_off = 300;
		
	}
	if(KillSwitch == 0)
	if(TogglePing)
	{
		if(get_val(ADS)&& double_click(PS4_UP)||event_press(FIRE))
		combo_run(Auto_Ping);
		
		if(!get_val(ADS))
		combo_stop(Auto_Ping);
	}
	
	if(KillSwitch == 0)
					
	if(!KS_Rapid_FIRE){
		if(get_ival(ADS) && event_release(PS4_RIGHT)){
			
			ToggleRapidFIRE =!ToggleRapidFIRE;
			combo_run(Menu_Rumble);
			
			if(!ToggleRapidFIRE)
			{		
				combo_stop(BLINK);
				set_led(Red, 1);
				set_led (0, 3);
			}
		}

    if(KillSwitch == 0)
		//--- RAPID FIRE
	if(ToggleRapidFIRE){
		
		hold_time = 500 / (  RateOfFIRE); 
		rest_time = hold_time - 20;
		if(rest_time < 0) rest_time = 0;
		
		if(get_val(FIRE))combo_run(RAPIDFIRE );
		else combo_stop(RAPIDFIRE );	
		
		led_on  = 150;
		led_off = 300;
		combo_run(BLINK);
	}
		}
	//==============================================

	if( Menu && !EditMenu) { 
	
		//--- EXIT from OLED MENU
		if( event_press( PS4_CIRCLE )) { Save_Exit()}
		
		//--- ENTER in EDIT MENU
		if( Menu  ){
			if( event_press( PS4_CROSS  )) { 
				EditMenu = TRUE;
				refresh_edit = TRUE; 
				edit_idx = Min_Max [Menu][0]; 
				construct = 0;  
			}
		}
		//--- BLOCK ALL INPUTS when we in OLED MENU
		block_all_inputs();
		
		
		if( event_press( PS4_RIGHT ) ) { 
			Menu++; 
			if( Menu > cycle_limit )  Menu = cycle_return;  
			construct = 1;
		}
		if( event_press( PS4_LEFT  ) ){ 
			Menu--; 
			if( Menu < cycle_return )  Menu = cycle_limit ; 
			construct = 1;
			
		}
		
		//--- RAPID FIRE
		if( Menu == Rapid_FIRE_menu ) {
			ToggleRapidFIRE = change_options(ToggleRapidFIRE, 1,0 );
		}
		//--- SLIDE CANCEL
		if( Menu == Slide_Cancel_Mod_Menu ) {
			ToggleSlideCancel = change_options(ToggleSlideCancel, 1,0 );
		}
		//--- POLAR ASSIST
		if( Menu ==Polar_Aim_Menu ) {
			TogglePolarAim = change_options(TogglePolarAim, 1,0 );
		}
		//--- TRACKER
		if( Menu == Tracker_Menu){
			ToggleTracker = change_options( ToggleTracker, 1,0 );
		}
		//PING MENU
		if( Menu == ping_Menu){
			TogglePing = change_options( TogglePing, 1,0 );
		}
		//BUNNY MENU
		if( Menu == Bunny_Menu){
			ToggleBunnyHop = change_options( ToggleBunnyHop, 1,0 );
		}
		//--- BUTTON LAYOUT
		if( Menu == ButtonLayout ) {
			BUTTON_LAYOUT = change_options(BUTTON_LAYOUT,18,0) ; 
		}
		//--- STICK LAYOUT
		if( Menu == StickLayout ) {
			STICK_LAYLOUT = change_options(STICK_LAYLOUT,5,0) ; 
		}
		//LEGACY
		if( Menu == AntiRecoilMenu) {		
			Toggle_AntiRecoil  = change_options(Toggle_AntiRecoil ,1,0 ); 
		}
		if( Menu == Rumble_Menu) {		
			ToggleVibration = change_options(ToggleVibration ,1,0 ); 
		}
		
	}
	
	
	if( Menu &&  EditMenu){
		
		//--- Exit Edit Menu --> back to OLED MENU
		if(event_press(PS4_CIRCLE)){  construct = 1; EditMenu = FALSE; }
		
		block_all_inputs();
		if(event_press(PS4_RIGHT)) {
			edit_idx++;
			if(edit_idx > Min_Max [Menu][1]) edit_idx = Min_Max [Menu][0];
			if(edit_idx < Min_Max [Menu][0]) edit_idx = Min_Max [Menu][0];
			
			refresh_edit = TRUE;
		}
		//--- GO LEFT---
		block_all_inputs();
		if(event_press(PS4_LEFT)) {
			edit_idx--;
			if(edit_idx < Min_Max [Menu][0]) edit_idx = Min_Max [Menu][1] ;
			refresh_edit = TRUE;
		}
		//--- REFRESH EDIT MENU
		if(refresh_edit){
			cls_oled( 1 );
			rect_oled( 1, 1, 126, 14, 1, 0 );
			
			//--- There is no Edit variables for this MOD
			if(Edit_ind[ Menu ] == 0 ){
				printf_mod_name();
				//---NO EDIT LABEL--- 
				line_oled(1,45,127,45,1,0);
				print( center_x( 17, ofsw ), 20, ofs, 0, NO_EDIT_VAR1[0] );  
				print( center_x( 12, ofsw ), 33, ofs, 0, NO_EDIT_VAR2[0] ); 
			}
			//--- SLIDE CANCEL
			if( Menu == Slide_Cancel_Mod_Menu ) {
				printf_mod_name();  //                  val,       min, max, indx   
				
				if(edit_idx == 2) {display_edit( MwSlideDelay,  10,   120, 2 ) ;}				
			}
		
			//--POLAR---
			else if( Menu ==Polar_Aim_Menu ) {
				printf_mod_name();//                   val,       min, max, indx
				if(edit_idx == 0) {display_edit(PolarRadius,      0, 30, 0); }
				if(edit_idx == 1) {display_edit(PolarSteps ,      0, 30, 1); }	
			}
			//----TrackerCords---
			else if( Menu == Tracker_Menu ) {
				printf_mod_name();//                   val,                min, max, Indx 
				if(edit_idx == 3) {display_edit(TrackerStrength, 0 , 30, 3); }
				if(edit_idx == 4) {display_edit(TrackerSpeed   , 0 , 30, 4); }	
			} 
			
			else if( Menu == AntiRecoilMenu ) {
				printf_mod_name();//                   val,                       min,  max, indx   
				if(edit_idx == 5) {display_edit(RecoilV,      0 , 60, 5); }
				if(edit_idx == 6) {display_edit(RecoilH,    -50 , 60, 6); }
			}
		
			//------RAPID FIRE---------
			if( Menu == Rapid_FIRE_menu ) {
				printf_mod_name();//                   val,       min,  max, indx   
				if(edit_idx == 7) {display_edit( RateOfFIRE,   0,   25,  7 ) ;}				
			}
		}
			refresh_edit = FALSE;	
		}
		//---------SLIDE CANCEL-----------
		if( Menu == Slide_Cancel_Mod_Menu ) {
			printf_mod_name();//                                 var,       ,min,  max, step
			if(edit_idx == 2) { MwSlideDelay  = edit_val( MwSlideDelay , 10,   120,  1  ) ;}		
		}
		//POLAR
		else if( Menu ==Polar_Aim_Menu ) { 
			printf_mod_name();//                                   var,         ,min,  max, step
			if(edit_idx == 0) { PolarRadius     = edit_val( PolarRadius,       0,   30,  1  ) ;}
			if(edit_idx == 1) { PolarSteps  = edit_val( PolarSteps ,           0,   30,  1  ) ;}	
		}
		
		// TrackerCords
		else if( Menu == Tracker_Menu ) {
			printf_mod_name();//                                                var,                 ,min,  max, step 
			if(edit_idx == 3) { TrackerStrength  = edit_val( TrackerStrength ,  0,   30,  1  ) ;}
			if(edit_idx == 4) { TrackerSpeed     = edit_val( TrackerSpeed    ,  0,   30,  1  ) ;}				
		}
		//LEGACY
		else if( Menu == AntiRecoilMenu) {
			printf_mod_name();	//                                                         var,               ,min,  max, step                                                  
			if(edit_idx == 5) {RecoilV      = edit_val( RecoilV      ,  0,  60,    1  ) ;}
			if(edit_idx == 6) {RecoilH      = edit_val( RecoilH    ,  -50,   60,    1  ) ;}
        }

		else if( Menu == Rapid_FIRE_menu ) {
			printf_mod_name();	//                           var,       ,min,  max, step
			if(edit_idx == 7) { RateOfFIRE = edit_val(  RateOfFIRE , 0,   25,  1  ) ;}	
			
		}

	//--- SCREEN SAVER
	if( screen_saver ) {
		if( Menu == dash_board ) { strobing_a1(); }
		clear += get_rtime();
		if( clear >= 12000 ) { cls_oled( 0 ); clear = 0; screen_saver = 0; }
	}
}

/*===============================END OF MAIN BLOCK==========================

===============================COMBO START================================*/

combo WARZONE_SLIDE {
	set_val(CROUCH, 100);
	wait(MwSlideDelay); 
	set_val(CROUCH, 0);
	wait(60);
	set_val(CROUCH, 100);
	wait(50);
	set_val(CROUCH, 100);
	set_val(JUMP, 100);
	wait(60);
	set_val(CROUCH, 0);
	set_val(JUMP, 100);
	wait(10);
	set_val(JUMP, 0);
}
combo Bunnyhop{
	set_val(JUMP, 100);
	wait(30);
	set_val(JUMP, 0);
	wait(30);
	set_val(JUMP, 100);
	wait(30);
	set_val(JUMP, 0);
	wait(30);
}
combo Auto_Ping{
	set_val(PS4_UP,100);
	wait(20)
	set_val(PS4_UP,0);
	wait(20)
	set_val(PS4_UP,100);
	wait(20)
	set_val(PS4_UP,0);
}
combo YY {
	set_val(SWITCH, 100);
	wait(10);
	set_val(SWITCH,   0);
	wait(10);
	set_val(SWITCH, 100);
	wait(10);
	set_val(SWITCH,   0);
}	
        
combo RUMBLE_ON {
	set_rumble(RUMBLE_A, 50);
	wait(300);
	reset_rumble();
}
combo Menu_Rumble {
	set_rumble(RUMBLE_B,100);
	wait(200);
	reset_rumble();

}
combo BLINK {
	led(Yellow);
	wait(led_on);
	led(Red);
	wait(led_off);
}
combo RAPIDFIRE { 
	set_val(FIRE, 100);
	wait(hold_time);
	set_val(FIRE,   0);
	wait(rest_time);
	
}
//==========COMBO END==============================
data(1,// begin of data segment--------              
2,0,0,0, //1. Blue                                 
0,2,0,0, //2. Red                                  
0,0,2,0, //3. Green                                
0,0,0,2, //4. Pink                                 
2,0,2,0, //5. SkyBlue                              
0,2,2,0, //6. Yellow                               
2,2,2,2, //7. White 
0,0,0,0  //8. OFF
); // end of data

define Purple        =  1;                           
define Red           =  2;                           
define Blue          =  3;                           
define Pink          =  4;                           
define SkyBlue       =  5;                           
define Yellow        =  6;                           
define White         =  7;                           
define OFF_Color     =  8;    
//----- End of data segment--------  
function display_edit(f_val,f_min ,f_max , f_ind){	
	
	// on the left: min value
	number_to_string(f_min ,find_digits(f_min) ,4 , 18 , OLED_FONT_SMALL);
	// on the right: max value
	number_to_string(f_max ,find_digits(f_max) ,97 , 18 , OLED_FONT_SMALL);
	
	// print edit value on oled                                                           
	if( ((find_digits(f_val)/ 2) * OLED_FONT_MEDIUM_WIDTH == 0 )) horiz_X_center_sufix = 54;
	else horiz_X_center_sufix = 57 - ((find_digits(f_val)/ 2) * OLED_FONT_MEDIUM_WIDTH);     
	// number_to_string(f_val,f_digits ,printf_s_x , printf_s_y , f_font)                          
	number_to_string(f_val ,find_digits(f_val) ,horiz_X_center_sufix , EDIT_VAL_printf_Y , OLED_FONT_MEDIUM);// 45 
	
	//--- print label 
	//rect_oled( <x> , <y>, <width>, <height>, <fill>, <color> );

	//rect_oled(64, 45, ((f_val * 100) / f_max), 15, 1, 0); 
	if(f_val > 0 ) 
	rect_oled(15, 38, ((f_val * 100) / f_max) , 15, 1, 0);
	else if(f_val < 0 )
	rect_oled(115 - abs((f_val * 100) / f_max), 38,abs ((f_val * 100) / f_max), 15, 1, 0);
	//rect_oled(64,35,84,5,1,0);
	
	
	set_val(TRACE_1,((f_val * 100) / f_max) * 1);
	print( center_x( CharCount[f_ind], ofsw ), 55, ofs, 0, EditValuesNames[f_ind] );  
	rect_oled(15, 38, 100, 15, 0, 0);
		
}

function edit_val( f_val, f_min, f_max, f_inc1) {  // 
	
	f_val    = value_change( f_val ,XB1_DOWN , inv(f_inc1), f_min, f_max ); // inv(f_inc1)
	f_val    = value_change( f_val ,XB1_UP   , f_inc1     , f_min, f_max ); // f_inc1
	
	Stop_Input()
	
	return f_val;                        
}                      

function value_change(f_val,f_btn,f_inc, f_rng_min, f_rng_max) { 

	if(press_hold(f_btn)) 
	{
		f_val += f_inc;
		
		if (f_val > f_rng_max) f_val = f_rng_max;
		else if(f_val < f_rng_min) f_val = f_rng_min;
		
		refresh_edit  = TRUE;
	}
	return f_val; 
} 
function press_hold(f_btn) { 
    //  return TRUE - event_press()   
    //  - every 250 ms when button is held

    return event_press(f_btn) || (get_ival(f_btn) && get_ptime(f_btn) >= 500);
    //&& get_ptime(f_btn) % (get_rtime() * 8) == 0;
}
const uint8 Opt_BL [] = {
	7 , 8, 5, 13, 17, 17,13, 17, 17, 14, 7, 5, 15, 14, 17, 17,16 ,11,15
};
function OptionMenu_BL ( str_char , f_indx ) {

	print( center_x( str_char, ofsw ), 20, ofs, 0, BL_str[ f_indx ] );   

}
function printf_mod_name (){
	print( center_x( ModNames_char_count[Menu], ofsw ), 4, 0, 1, submenu_idx[ Menu  ] )
}
function change_options (f_var, max_val, min_val) {

	if( event_press( XB1_DOWN ) )   { 
		f_var++;
		construct = 1;
		//GM_changed = TRUE;
		if( f_var > max_val ) f_var =  min_val; 
		return f_var;
	}
	else if( event_press( XB1_UP ) )   { 
		f_var--; 
		construct = 1;
		//GM_changed = TRUE;
		if( f_var < min_val ) f_var =  max_val; 
		return f_var;
	}
	Stop_Input()
	
	return f_var;
}
function center_x( menu_chars, menu_font ) {
	return( OLED_WIDTH / 2 ) - ( ( menu_chars * menu_font ) / 2 );
}

function led( f_color ) {
	for( i = 0; i <= 3; i++ ) {
		set_led( i, duint8( ( (f_color * 4) - 3 ) + i ) );
	}
}
int double__tap;
function double_click(button) {        
	if (double__tap[button] >= 0) {                    
		double__tap[button] += get_rtime(); 
		if (double__tap[button] > 450)
		double__tap[button] = -1;                                                                                       
	}           
	if (event_release(button) && get_ptime(button) <= 200) { 
		if (double__tap[button] < 0) {                    
			double__tap[button] = 0;                        
		} else {             
			double__tap[button] = -1;                       
			return 1;                                   
		}                                                     
	}                                                  
	return 0;
}
function strobing_a1() {
	strobing_a = strobing_a + get_rtime();

	//print( center_x( 10, ofsw ), 35, 0, 0, MenuOption[ 0 ] );
	//rect_oled(20, 38, 90, 33, 1,0 );
	if(strobing_a <= 3000){
		show_OPEN_MENU( 1 )
	}else{
		show_Edit_Menu ( 1 );
	}
	
	if( strobing_a > 6000 ) {
		strobing_a = 0;
	}
}
function strobing_b1() {
	strobing_b = strobing_b + get_rtime();
	if( strobing_b < 500 ) {
		l_active( 25, 49, 0 );
		u_active( 46, 49, 0 );
		r_active( 88, 49, 0 );
		d_active( 67, 49, 0 );
	}
	if( strobing_b > 500 ) {
		l_active( 25, 49, 1 );
		u_active( 46, 49, 1 );
		r_active( 88, 49, 1 );
		d_active( 67, 49, 1 );
	}
	if( strobing_b > 1000 ) {
		strobing_b = 0;
	}
}

function l_active( x, y, c ) {
	pixel_oled(2 + x, 6 + y, c ); pixel_oled(3 + x, 6 + y, c ); pixel_oled(2 + x, 7 + y, c );
	pixel_oled(3 + x, 7 + y, c ); pixel_oled(4 + x, 7 + y, c ); pixel_oled(2 + x, 8 + y, c );
	pixel_oled(3 + x, 8 + y, c );
}
function u_active( x, y, c ) {
	pixel_oled( 6 + x, 2 + y, c ); pixel_oled( 7 + x, 2 + y, c ); pixel_oled( 8 + x, 2 + y, c );
	pixel_oled( 6 + x, 3 + y, c ); pixel_oled( 7 + x, 3 + y, c ); pixel_oled( 8 + x, 3 + y, c );
	pixel_oled( 7 + x, 4 + y, c );
}
function r_active( x, y, c ) {
	pixel_oled( 11 + x, 6 + y, c ); pixel_oled( 12 + x, 6 + y, c ); pixel_oled( 10 + x, 7 + y, c );
	pixel_oled( 11 + x, 7 + y, c ); pixel_oled( 12 + x, 7 + y, c ); pixel_oled( 11 + x, 8 + y, c );
	pixel_oled( 12 + x, 8 + y, c );
}
function d_active( x, y, c ) {
	pixel_oled( 7 + x, 10 + y, c ); pixel_oled( 6 + x, 11 + y, c ); pixel_oled( 7 + x, 11 + y, c );
	pixel_oled( 8 + x, 11 + y, c ); pixel_oled( 6 + x, 12 + y, c ); pixel_oled( 7 + x, 12 + y, c );
	pixel_oled( 8 + x, 12 + y, c );
}
//========MENU EDITS ================================
const string NO_EDIT_VAR1  = "No Edit Variables";  //
const string NO_EDIT_VAR2  = "for this MOD";       //
const string LT_MENU       = "   OPEN MENU  ";        //
const string L2_OPTIONS    = " L2 + OPTIONS ";        //
const string EDIT_MENU1    = "  KILLSWITCH  ";        //
const string EDIT_MENU2    = " L2  +  SHARE ";        //
//===================================================

function show_OPEN_MENU( color ) {

	print(center_x(14, ofsw ), 50, ofs, color, LT_MENU[0]    );  
	print(center_x(14, ofsw ), 50, ofs, color, L2_OPTIONS[0] );  
	
}
function show_Edit_Menu( color ) {

	print(center_x(15, ofsw ), 50, ofs, color, EDIT_MENU1[0] );  
	print(center_x(15, ofsw ), 50, ofs, color, EDIT_MENU2[0] );  
	
}

function get_mvt_direction( _val, _lval) {
	if (abs(_val - _lval) <= 2)
	return 0;

	if (_val < _lval) //move left
	return -1;

	if (_val > _lval)
	return 1;

	return 0;
}

 
const string SAVE  = "SAVED";
combo SAVE { 
	cls_oled(0);						
	print(center_x(sizeof(SAVE) - 1,OLED_FONT_LARGE_WIDTH),center_y(OLED_FONT_LARGE_HEIGHT),OLED_FONT_LARGE,OLED_WHITE,SAVE[0]); 	
	wait(10)
	
	wait(300);
	cls_oled(0);
	wait(100);
	Menu = dash_board; 
	construct = 1; 
	strobing_b1();
	
	
}

function sin(angle)
{   
	if(angle <= 90)
	{             
		_ret = (TrackerCords[angle]);
	}
	else if (angle <= 180)
	{      
		_ret = (TrackerCords[180 - angle]);
	}
	else if (angle <= 270)
	{
		_ret = inv(TrackerCords[angle - 180]);     
	}
	else 
	{
		_ret = inv(TrackerCords[360 - angle]);      
	}
	
	return _ret;
}
function cos(angle)
{   
	if(angle <= 90)
	{             
		_ret = (TrackerCords[90 - angle]);
	}
	else if (angle <= 180)
	{      
		_ret = inv(TrackerCords[angle - 90]);
	}
	else if (angle <= 270)
	{
		_ret = inv(TrackerCords[270 - angle]);       
	}
	else 
	{
		_ret = (TrackerCords[angle - 270]);       
	}
	
	return _ret;
}
function get_polar_coordinate(Radius, coef)
{
	if(Radius > 32)
	{
		Radius = 32;
	}
	
	return((Radius * coef) / 1000);		
}


function display_QT(togg_number){                           
	cls_oled(0);
	
	if( togg_number == 1){
		printf_QT( sizeof(Add_QT_1 ) , Add_QT_1[0] );
		if(KillSwitch){                                                          
			print( 36 ,30 , OLED_FONT_LARGE , OLED_WHITE , QT_OFF[0] ); 
			screen_saver = 0;
		}else{                                                                   
			print( 45 ,30 , OLED_FONT_LARGE , OLED_WHITE , QT_ON[0] );
		}
	} 
	
	combo_run(WAIT_MESSAGE);  
} 
combo WAIT_MESSAGE {

	wait(1500);
	cls_oled(0);
	wait(100);
}

function center_y(f_size) { 
	return (OLED_HEIGHT  / 2) - (f_size / 2);
}          
//====================================================================================== 
//   Quick Toggles                                    
//====================================================================================== 

const string  QT_ON  ="ON"; 
const string  QT_OFF ="OFF"; 

function printf_QT (f_cheract_size ,  f_label ){                         
	rect_oled(1,1,127,63,0,1);                                          
	line_oled(1,20,127,20,1,1);                                         
	print( center_x( f_cheract_size , OLED_FONT_MEDIUM_WIDTH)    , 2 , OLED_FONT_MEDIUM , OLED_WHITE, f_label); 
}                                                                           
const string Add_QT_1 = " SCRIPT";
//display_Add_QT (1 ); //  - add this code to the Quick Toggle : SCRIPT IS	

// Variables for function number_to_string()  
int n_str_;                            
int c,c_val; 
int horiz_X_center_sufix;
// f_val:value  | f_digits: 1 to 5 | printf_s_x: aim_x | printf_s_y  | f_font  
function number_to_string(f_val,f_digits ,printf_s_x , printf_s_y , f_font) {                  

	n_str_ = 1;  c_val = 10000;                            
	
	if(f_val < 0)                     
	{                                                 
		putc_oled(n_str_,45);     
		n_str_ += 1;                                      
		f_val = abs(f_val);  
		
	}                                                 
	
	for(c = 5; c >= 1; c--)                           
	{                                                 
		if(f_digits >= c)                             
		{                                             
			putc_oled(n_str_,ASCII_NUM[f_val / c_val]);    
			f_val = f_val % c_val;                    
			n_str_ +=  1;                                  
			
		}                                             
		c_val /= 10;                                  
	}                                                
	puts_oled(printf_s_x,printf_s_y,f_font,n_str_ - 1,OLED_BLACK); // adjustable value centered in aim_x 
}     
const uint8 ASCII_NUM[] =                          
//      0  1  2  3  4  5  6  7  8  9  (column numbers)
{48,49,50,51,52,53,54,55,56,57};  
function find_digits(f_num) {                         
	//  find_digits(value)                                
	//        return Number of Digits in Value Passed     
	
	f_num = abs(f_num);                               
	if(f_num / 10000 > 0) return 5;                   
	if(f_num /  1000 > 0) return 4;                   
	if(f_num /   100 > 0) return 3;                   
	if(f_num /    10 > 0) return 2;                   
	return 1;                  
} 
function Stop_Input() { 
	set_val(JUMP,0);set_val(CROUCH,0);  
	set_val(TACTICAL,0);set_val(LETHAL,0);  
	set_val(RELOAD,0); set_val(SWITCH,0);
	set_val(PING,0);set_val(MELEE,0);
	set_val(SPRINT,0);set_val(strafe,0);set_val(walk,0);
	set_val(PS4_OPTIONS,0);set_val(PS4_SHARE,0); 
	set_val(PS4_LEFT,0); set_val(PS4_TRIANGLE,0); 
	set_val(PS4_CROSS,0);set_val(PS4_CIRCLE,0); 
	set_val(PS4_SQUARE,0);set_val(PS4_UP,0);   
	set_val(PS4_DOWN,0);set_val(PS4_RIGHT,0);
} 
int FIRE;
int ADS;
int LETHAL;
int TACTICAL;
int JUMP;
int SWITCH;
int RELOAD; 
int CROUCH;
int MELEE;
int SPRINT;
int PING;

const int16 BL[][] = {            
	 //FIRE    ADS        LETHAL        TACTICAL          JUMP    SWITCH        RELOAD    CROUCH    MELEE   SPRINT   PING
	{XB1_RT,   XB1_LT,    XB1_RB,        XB1_LB,        XB1_A,    XB1_Y,        XB1_X,     XB1_B,   XB1_RS, XB1_LS,  XB1_UP  },     // DEFAULT
	{XB1_RT,   XB1_LT,    XB1_RB,        XB1_LB,        XB1_A,    XB1_Y,        XB1_X,     XB1_RS,  XB1_B,  XB1_LS,  XB1_UP  },     // TACTICAL
	{XB1_LT,   XB1_RT,    XB1_LB,        XB1_RB,        XB1_A,    XB1_Y,        XB1_X,     XB1_B,  XB1_LS, XB1_RS ,  XB1_UP },     // LEFTY
	{XB1_RT,   XB1_RB,    XB1_LT,        XB1_LB,        XB1_A,    XB1_Y,        XB1_X,     XB1_B,  XB1_RS, XB1_LS ,  XB1_UP },     // N0M4D/CHARLIE
	{XB1_RT,   XB1_RB,    XB1_LT,        XB1_LB,        XB1_A,    XB1_Y,        XB1_X,     XB1_RS, XB1_B,  XB1_LS ,  XB1_UP },     // N0M4D/CHARLIE TACTIVAL
	{XB1_LT,   XB1_LB,    XB1_RT,        XB1_RB,        XB1_A,    XB1_Y,        XB1_X,     XB1_B,  XB1_LS, XB1_RS ,  XB1_UP },     // N0M4D/CHARLIE L3F7Y
	{XB1_RT,   XB1_LT,    XB1_RB,        XB1_A,        XB1_LB,    XB1_Y,        XB1_X,     XB1_B,  XB1_RS, XB1_LS ,  XB1_UP },     // BUMPER JUMPER
	{XB1_RT,   XB1_LT,    XB1_RB,        XB1_A,        XB1_LB,    XB1_Y,        XB1_X,     XB1_RS, XB1_B,  XB1_LS ,  XB1_UP },     // BUMPER JUMPER TACTICAL
	{XB1_LB,   XB1_LT,    XB1_RT,        XB1_RB,        XB1_A,    XB1_Y,        XB1_X,     XB1_B,  XB1_RS, XB1_LS ,  XB1_UP },     // ONE-HAND GUNSLINGER
	{XB1_RT,   XB1_LT,    XB1_RB,        XB1_LB,       XB1_RS,    XB1_Y,        XB1_X,     XB1_B,  XB1_A,  XB1_LS ,  XB1_UP },     // STICK AND MOVE
	{XB1_RT,   XB1_LT,    XB1_RB,        XB1_LB,        XB1_A,    XB1_Y,        XB1_X,     XB1_B,  XB1_RS, XB1_LS ,  XB1_UP },     // BRAWLER
	{XB1_RT,   XB1_LT,    XB1_RS,        XB1_A,        XB1_LB,    XB1_Y,        XB1_X,     XB1_B,  XB1_RB, XB1_LS ,  XB1_UP },     // BEAST
	{XB1_RB,   XB1_LB,    XB1_RT,        XB1_LT,        XB1_A,    XB1_Y,        XB1_X,     XB1_B,  XB1_RS, XB1_LS ,  XB1_UP },     // DEFAULT SWITCHED
	{XB1_RB,   XB1_LB,    XB1_RT,        XB1_A,        XB1_LB,    XB1_Y,        XB1_X,     XB1_B,  XB1_RS, XB1_LS ,  XB1_UP },     // BUMPER JUMPER SWITCHED 
	{XB1_RB,   XB1_LB,    XB1_RT,        XB1_A,        XB1_LB,    XB1_Y,        XB1_X,     XB1_RS, XB1_B,  XB1_LS ,  XB1_UP },     // BUMPER JUMPER TACTICAL SWITCHED 
	{XB1_RB,   XB1_LB,    XB1_RT,        XB1_LT,       XB1_RS,    XB1_Y,        XB1_X,     XB1_B,  XB1_A,  XB1_LS ,  XB1_UP },     // STICK AND MOVE SWITCHED
	{XB1_RB,   XB1_LB,    XB1_RT,        XB1_LT,        XB1_A,    XB1_Y,        XB1_X,     XB1_RS, XB1_B,  XB1_LS ,  XB1_UP },     // TACTICAL SWITCHED
	{XB1_RB,   XB1_LB,    XB1_RT,        XB1_RT,        XB1_A,    XB1_Y,        XB1_X,     XB1_B,  XB1_RS, XB1_LS ,  XB1_LT },     // BUMPER PING = 18
	{XB1_RB,   XB1_LB,    XB1_RT,        XB1_RT,        XB1_A,    XB1_Y,        XB1_X,     XB1_RS, XB1_B,  XB1_LS ,  XB1_LT }};    // BUMPER PING TACTICAL = 19		
	
		


const int16 SL[][] = {            
	//Walk,     Strafe, AimY,    AimX    
	{ XB1_LY,     XB1_LX, XB1_RY, XB1_RX },    // DEFAULT
	{ XB1_RY,     XB1_RX, XB1_LY, XB1_LX },    // SOUTHPAW
	{ XB1_LY,     XB1_RX, XB1_RY, XB1_LX },    // LEGACY
	{ XB1_RY,     XB1_LX, XB1_LY, XB1_RX },    // LEGACY SOUTHPAW
	{ XB1_RY,     XB1_RX, XB1_LY, XB1_LX },    // SOUTHPAW NO CLICK SWAP
	{ XB1_RY,     XB1_LX, XB1_LY, XB1_RX }};   // LEGACY SOUTHPAW NO CLICK SWAP

int aim_y,aim_x; 

int BUTTON_LAYOUT,STICK_LAYLOUT;

//#################################################################################################
//######################################### Sweet_EviL_14 #########################################
//################################################################################################# 
//#     _________                      __    ___________     .__.____       ____   _____          #
//#    /   _____/_  _  __ ____   _____/  |_  \_   _____/__  _|__|    |     /_   | /  |  |         #
//#    \_____  \\ \/ \/ // __ \_/ __ \   __\  |    __)_\  \/ /  |    |      |   |/   |  |_        #
//#    /        \\     /\  ___/\  ___/|  |    |        \\   /|  |    |___   |   /    ^   /        #
//#   /_______  / \/\_/  \___  >\___  >__|   /_______  / \_/ |__|_______ \  |___\____   |         #
//#           \/             \/     \/               \/                 \/           |__|         #
//#                                                                                               #
//#################################################################################################
//############################ Sweet_EviL_14 pvar bit packing 2.0.1 ###############################
//################################################################################################# 
int mask;

int pval_data;
function pack_unsigned(int pvar, int _ret, int position, int number_of_bits){ 
	for(i = position; i< (number_of_bits + position); i++)
	{
		pvar = pvar & (~(1 << i));
	}
	pvar = pvar | (_ret<<position);
	return pvar;
}
function unpack_unsigned(int pvar, int position, int number_of_bits){
	mask = 0;
	_ret = 0;
	for(i = 0; i< number_of_bits ; i++)
	{
		mask = mask | (1 << i);
	}
	mask = mask <<position
	_ret = (pvar & mask) >> position
	return _ret;
}
function pack_signed(int var1, int var2){

	_ret = 0;
	if(var1 < 0)
	{
		var1 = abs(var1) | 128;
	}
	_ret = (abs(var2)<<8)|var1;
	
	if(var2<0)
	_ret *= -1;
	return _ret;
}
function unpack_signed(int pvar, int var){
	_ret = 0;
	if(var == 0)
	{	 
		_ret = 128 & abs(pvar) ;
		_ret = _ret >> 7;
		_ret = ((-2) * _ret) + 1;
		_ret = ( abs(pvar) & 127) * _ret;
	}
	else
	{
		_ret = pvar>>8;

		if(pvar<0)
		{
			_ret += 1;
		}
	}
	return _ret;
}

	function  LOAD_PVARS() {
	pval_data = get_pvar(SPVAR_1, 1, 147483647, 0);	
    TogglePolarAim     = unpack_unsigned(pval_data, 0, 1);
    ToggleTracker      = unpack_unsigned(pval_data, 1, 1);
	ToggleInverted     = unpack_unsigned(pval_data, 2, 1); 
    ToggleSlideCancel  = unpack_unsigned(pval_data, 3, 1);
    ToggleRapidFIRE    = unpack_unsigned(pval_data, 4, 1);
    ToggleBunnyHop     = unpack_unsigned(pval_data, 5, 1);
    TogglePing         = unpack_unsigned(pval_data, 6, 1);
    ToggleVibration    = unpack_unsigned(pval_data, 7, 1);

    pval_data = get_pvar(SPVAR_2,  1,147483647,pack_signed(15, 9));
	PolarRadius        = unpack_signed(pval_data, 0);
	PolarSteps         = unpack_signed(pval_data, 1);

	pval_data = get_pvar(SPVAR_3,1,147483647,pack_signed(10,4 ));
	TrackerStrength    = unpack_signed(pval_data, 0);
	TrackerSpeed       = unpack_signed(pval_data, 1);
	
	
	pval_data = get_pvar(SPVAR_4,  1,147483647,pack_signed(28, -2));
	RecoilV       = unpack_signed(pval_data, 0);
	RecoilH      = unpack_signed(pval_data, 1);

	pval_data = get_pvar(SPVAR_5,1,147483647,pack_signed(80, 12));
	MwSlideDelay        = unpack_signed(pval_data, 0);
	RateOfFIRE         = unpack_signed(pval_data, 1);

	pval_data = get_pvar(SPVAR_6,-147483647, 147483647, 0);
	MwSlide          = unpack_signed(pval_data, 0);
    Toggle_AntiRecoil  = unpack_signed(pval_data, 1);

    BUTTON_LAYOUT                   = get_pvar(SPVAR_7,   0,     18,     0); 
    STICK_LAYLOUT                   = get_pvar(SPVAR_8,   0,      5,     0);

	
	
    
   
  } 
function Save_Exit(){ 

 
  pval_data = pack_unsigned(pval_data, TogglePolarAim                ,0, 1);
  pval_data = pack_unsigned(pval_data, ToggleTracker                 ,1, 1);
  pval_data = pack_unsigned(pval_data, ToggleInverted                ,2, 1);
  pval_data = pack_unsigned(pval_data, ToggleSlideCancel             ,3, 1);
  pval_data = pack_unsigned(pval_data, ToggleRapidFIRE               ,4, 1);
  pval_data = pack_unsigned(pval_data, ToggleBunnyHop                ,5, 1);
  pval_data = pack_unsigned(pval_data, TogglePing                    ,6, 1);
  pval_data = pack_unsigned(pval_data, ToggleVibration               ,7, 1);
  set_pvar(SPVAR_1,pval_data);
                                              
  pval_data = pack_signed(PolarRadius ,PolarSteps);
  set_pvar(SPVAR_2,pval_data);  
                                                          
  pval_data = pack_signed(TrackerStrength,TrackerSpeed ); 
  set_pvar(SPVAR_3,pval_data);
                                                         
  pval_data = pack_signed(RecoilV  ,RecoilH); 
  set_pvar(SPVAR_4,pval_data);

  pval_data = pack_signed(MwSlideDelay,RateOfFIRE); 
  set_pvar(SPVAR_5,pval_data);
  
  pval_data = pack_signed(MwSlide,Toggle_AntiRecoil);
  set_pvar(SPVAR_6,pval_data);
 
  set_pvar(SPVAR_7,BUTTON_LAYOUT)
  set_pvar(SPVAR_8,STICK_LAYLOUT); 
 
 combo_run(SAVE);

 //SPVARS USED 8   
}


int anti_recoil,anti_recoil_H;
combo AntiRecoil {  
	anti_recoil = get_val(aim_y) + RecoilV * inverted      
	if(anti_recoil > 100) anti_recoil = 100;      
	set_val(aim_y, anti_recoil);                     
	anti_recoil_H = get_val(aim_x) + RecoilH * inverted  
	if(anti_recoil_H > 100) anti_recoil_H = 100;  
	set_val(aim_x, anti_recoil_H);   
} 

int __pictureWidth, __pictureX, __pictureHeight, __pictureY, __pictureBit, __pictureOffset, __pictureData;
int __pictureX2, __pictureY2;
function draw_picture(x, y) {
	__pictureOffset = 1; // Reset the starting point
	__pictureBit = 0; // Reset bit flag
	__pictureWidth = picture[0]; // Fetch the width of what to draw
	__pictureHeight = picture[1]; // Fetch the height of what to draw
	for (__pictureY = 0; __pictureY < __pictureHeight; __pictureY++) { // Loop the Y axis
		__pictureY2 = y + __pictureY;
		if (__pictureY2 < 0 || __pictureY2 >= 64) {
			__pictureY2 -= 64;
		}
		for (__pictureX = 0; __pictureX < __pictureWidth; __pictureX++) { // Loop the X axis
			if (!__pictureBit) { // Check if we've already handled the last bit
				__pictureBit = 16; // Reset the bit flag
				__pictureOffset++; // Move to the next value
				__pictureData = picture[__pictureOffset]; // Fetch the value
			}
			__pictureBit--; // Decrement the bit flag, we're moving to the next bit
			__pictureX2 = x + __pictureX;
			if (__pictureX2 < 0 || __pictureX2 >= 128) {
				__pictureX2 -= 128;
			}
			pixel_oled(__pictureX2, __pictureY2, test_bit(__pictureData, __pictureBit));
		}
	}
}
int update_timer,C_RX,C_RY,L_RX,C_LX,C_LY ,strafe,walk;
int inverted,TrackerAngle ;
int mvt_direction,_ret;
int i;
int KS_Rapid_FIRE;
int hold_time,rest_time;                                                    
int led_on,led_off;
int RS_gr;
int mn=326, mx=328; 
define RS=POLAR_RS;
int	ToggleVibration       = TRUE;
int rnd;
int MwSlide; 
int MwSlideDelay;
int KillSwitch;
int REFRESH_RATE					= 4 * 10;
int ToggleRapidFIRE[2]
int Radius;
int RecoilV[2]; 
int RecoilH[2]; 
int PolarSteps ;
int PolarRadius;
int POLARBOOSTER     = TRUE;
int ToggleSlideCancel = TRUE
int Toggle_AntiRecoil[2];
int ToggleTracker;
int TogglePolarAim;
int PR_BOOST = 6;
int ToggleBunnyHop;
int TrackerStrength;
int TrackerSpeed;
int RateOfFIRE;
int TogglePing;	
define MAX_DRIFT			        = 15;
define timelimit 					= 75;
int ToggleInverted;
int drift_calib,rx_drift,ry_drift,lx_drift,ly_drift;

define ofmw = OLED_FONT_MEDIUM_WIDTH;
define ofsw = OLED_FONT_SMALL_WIDTH;
define ofs  = OLED_FONT_SMALL;
define ofm  = OLED_FONT_MEDIUM;
define ofl  = OLED_FONT_LARGE;


const int16 picture[] = {96, 62, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFF80, 0xFFFF, 0xFFFF, 0x003F, 0xFFFF, 0xFFFF, 0xFC00, 0x3E00, 0x00FC, 0x001F, 0xFFFF, 0xFFFF, 0xF000, 0x0000, 0x0000, 0x000F, 0xFFFF, 0xFFFF, 0xE000, 0x0000, 0x0000, 0x0003, 0xFFFF, 0xFFFF, 0xE000, 0x0000, 0x0000, 0x0F81, 0xFFFF, 0xFFFF, 0xC0F0, 0x0000, 0x0000, 0x0FC1, 0xFFFF, 0xFFFF, 0x83F0, 0x000F, 0xF800, 0x0FE1, 0xFFFF, 0xFFFF, 0x87F0, 0x00FF, 0xFFC0, 0x07F0, 0xFFFF, 0xFFFF, 0x87F0, 0x07FF, 0xFFF0, 0x07F0, 0xFFFF, 0xFFFF, 0x8FE0, 0x1FFF, 0xFFFC, 0x03F0, 0xFFFF, 0xFFFF, 0x8FE0, 0x3FFF, 0xFFFF, 0x03F0, 0xFFFF, 0xFFFF, 0x8FC0, 0xFFFF, 0xFFFF, 0x81F0, 0xFFFF, 0xFFFF, 0x8F81, 0xFFFF, 0xFFFF, 0xC0E0, 0xFFFF, 0xFFFF, 0x8703, 0xFFFF, 0xFFFF, 0xE060, 0xFFFF, 0xFFFF, 0x8603, 0xFFFF, 0xFFFF, 0xF001, 0xFFFF, 0xFFFF, 0x8007, 0xFFFF, 0xFFFF, 0xF801, 0xFFFF, 0xFFFF, 0xC00F, 0xFFFF, 0xFFFF, 0xF801, 0xFFFF, 0xFFFF, 0xC01F, 0xFFFF, 0xFFFF, 0xFC03, 0xFFFF, 0xFFFF, 0xE01F, 0xFFFF, 0xFFFF, 0xFE03, 0xFFFF, 0xFFFF, 0xE03F, 0xFFFF, 0xFFFF, 0xFE03, 0xFFFF, 0xFFFF, 0xE03F, 0xFFFF, 0xFFFF, 0xFF03, 0xFFFF, 0xFFFF, 0xE07F, 0xFFFF, 0xFFFF, 0xFF03, 0xFFFF, 0xFFFF, 0xE07F, 0xFFFF, 0xFFFF, 0xFF83, 0xFFFF, 0xFFFF, 0xE07F, 0xE3FF, 0xFF80, 0xFF81, 0xFFFF, 0xFFFF, 0xE0FF, 0x007F, 0xFE00, 0x3F81, 0xFFFF, 0xFFFF, 0xC0FE, 0x003F, 0xFC00, 0x1F81, 0xFFFF, 0xFFFF, 0xC0FC, 0x001F, 0xF800, 0x0FC1, 0xFFFF, 0xFFFF, 0xC0F8, 0x060F, 0xF838, 0x07C1, 0xFFFF, 0xFFFF, 0xC0F0, 0x1F0F, 0xF87C, 0x03C1, 0xFFFF, 0xFFFF, 0xC1E0, 0x1F8F, 0xF07C, 0x01C1, 0xFFFF, 0xFFFF, 0xC1C0, 0x1F8F, 0xF07C, 0x00C1, 0xFFFF, 0xFFFF, 0xC1C0, 0x0F0F, 0xF87C, 0x00C1, 0xFFFF, 0xFFFF, 0xC180, 0x060F, 0xF830, 0x00C1, 0xFFFF, 0xFFFF, 0xC180, 0x001F, 0xF800, 0x0041, 0xFFFF, 0xFFFF, 0xC180, 0x001F, 0xFC00, 0x0041, 0xFFFF, 0xFFFF, 0xC180, 0x003C, 0x1E00, 0x0041, 0xFFFF, 0xFFFF, 0xC080, 0x0078, 0x0600, 0x0041, 0xFFFF, 0xFFFF, 0xC080, 0x00F0, 0x0700, 0x0041, 0xFFFF, 0xFFFF, 0xC080, 0x00F0, 0x0380, 0x0041, 0xFFFF, 0xFFFF, 0xE0C0, 0x01F0, 0x03C0, 0x0081, 0xFFFF, 0xFFFF, 0xE0C0, 0x03F0, 0x07E0, 0x0083, 0xFFFF, 0xFFFF, 0xE060, 0x07F8, 0x0FF0, 0x0183, 0xFFFF, 0xFFFF, 0xE070, 0x0FFC, 0x1FF8, 0x0303, 0xFFFF, 0xFFFF, 0xF03F, 0xFFFF, 0xFFFE, 0x0F03, 0xFFFF, 0xFFFF, 0xF03F, 0xFFCF, 0xF8FF, 0xFE07, 0xFFFF, 0xFFFF, 0xF81F, 0xFFC7, 0xF0FF, 0xFC07, 0xFFFF, 0xFFFF, 0xFC0F, 0xFFC0, 0x01FF, 0xF80F, 0xFFFF, 0xFFFF, 0xFC07, 0xFFE0, 0x03FF, 0xF00F, 0xFFFF, 0xFFFF, 0xFE03, 0xFFF8, 0x0FFF, 0xE01F, 0xFFFF, 0xFFFF, 0xFF00, 0xFFFF, 0xFFFF, 0x803F, 0xFFFF, 0xFFFF, 0xFF80, 0x3FFF, 0xFFFF, 0x007F, 0xFFFF, 0xFFFF, 0xFFC0, 0x0FFF, 0xFFF8, 0x00FF, 0xFFFF, 0xFFFF, 0xFFE0, 0x00FF, 0xFFC0, 0x01FF, 0xFFFF, 0xFFFF, 0xFFF0, 0x0007, 0xF800, 0x07FF, 0xFFFF, 0xFFFF, 0xFFFC, 0x0000, 0x0000, 0x0FFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x0000, 0x0000, 0x3FFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xC000, 0x0001, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xF800, 0x000F, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFC0, 0x00FF, 0xFFFF};
  